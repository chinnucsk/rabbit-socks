<html>
  <head>
    <title>Rabbit Socks</title>
    <script type="text/javascript"
            src="http://cdn.socket.io/stable/socket.io.js"></script>
    <script type="text/javascript"
            src="rabbit.io.js"></script>
    <style type="text/css">
      #output {
        border: 1px solid black;
        width: 300px;
        padding: 4px;
      }
      #output p {
        padding: 2px;
        margin: 2px;
      }
    </style>
  </head>
  <body>
    <h1>
      Rabbit Socks
    </h1>
    <h2>Echo over socket.io</h2>
    <p>
      Enter text here; it will be echoed below.
    </p>
    <form onsubmit="send(); return false;">
      <input id="postbox" type="text"/>
      <input type="submit" value="Send"/>
    </form>
    <div id="output">
    </div>
    <script type="text/javascript">
      var sock = new io.Socket('localhost', {port: 5975,
                                             resource: 'socket.io/echo'});
      var postbox = document.getElementById('postbox');
      var output = document.getElementById('output');


      function display(msg) {
        var line = document.createElement('p');
        line.innerHTML = msg;
        output.appendChild(line);
      }


      var s = new io.RabbitIO(sock);
      s.subscribe("chan", function(msg){
           display(msg);
      });
      s.connect();

      function send() {
          s.publish("chan", postbox.value);
          postbox.value = '';
      }
    </script>
  </body>
</html>
